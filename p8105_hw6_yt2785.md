p8105 hw6 yt2785
================
Yijing Tao (UNI yt2785)
Nov 2021

``` r
library(tidyverse)
```

    ## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --

    ## v ggplot2 3.3.5     v purrr   0.3.4
    ## v tibble  3.1.4     v dplyr   1.0.7
    ## v tidyr   1.1.3     v stringr 1.4.0
    ## v readr   2.0.1     v forcats 0.5.1

    ## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
    ## x dplyr::filter() masks stats::filter()
    ## x dplyr::lag()    masks stats::lag()

``` r
library(modelr)
library(mgcv)
```

    ## 载入需要的程辑包：nlme

    ## 
    ## 载入程辑包：'nlme'

    ## The following object is masked from 'package:dplyr':
    ## 
    ##     collapse

    ## This is mgcv 1.8-38. For overview type 'help("mgcv-package")'.

``` r
set.seed(1)
```

## Problem 1

Read and clean the data.

``` r
#read csv
birthweight_df = 
  read_csv("./birthweight.csv") %>% 
  mutate(
    babysex = recode(babysex, '1' = "male", '2' = "female"),
    babysex = as.factor(babysex),
    frace = recode(frace, '1' = "white", '2' = "black", '3' = "asian", '4' = "puerto_rican", '8' = "other", '9' = "unknown"),
    frace = as.factor(frace),
    malform = recode(malform, '0' = "absent", '1' = "present"),
    malform = as.factor(malform),
    mrace = recode(mrace, '1' = "white", '2' = "black", '3' = "asian", '4' = "puerto_rican", '8' = "other"),
    mrace = as.factor(mrace)
  )
```

    ## Rows: 4342 Columns: 20

    ## -- Column specification --------------------------------------------------------
    ## Delimiter: ","
    ## dbl (20): babysex, bhead, blength, bwt, delwt, fincome, frace, gaweeks, malf...

    ## 
    ## i Use `spec()` to retrieve the full column specification for this data.
    ## i Specify the column types or set `show_col_types = FALSE` to quiet this message.

``` r
#check whether there are missing datas
any(is.na(birthweight_df))
```

    ## [1] FALSE

``` r
birthweight_df %>% 
  ggplot(aes(x = bhead, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-1.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = blength, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-2.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = delwt, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-3.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = fincome, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-4.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = gaweeks, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-5.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = menarche, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-6.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = mheight, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-7.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = momage, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-8.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = parity, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-9.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = pnumlbw, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-10.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = pnumsga, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-11.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = ppbmi, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-12.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = ppwt, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-13.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = smoken, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-14.png)<!-- -->

``` r
birthweight_df %>% 
  ggplot(aes(x = wtgain, y = bwt)) + 
  geom_point()
```

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-3-15.png)<!-- -->

From the plots above we can infer that the birthweight is only related
to `bhead` and `blength`.

``` r
fit_null1 = lm(bwt ~ bhead + blength, data = birthweight_df)
fit_alt1 = lm(bwt ~ bhead + blength + delwt, data = birthweight_df)

anova(fit_null1, fit_alt1) %>% 
  broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df    sumsq statistic   p.value
    ##    <dbl>      <dbl> <dbl>    <dbl>     <dbl>     <dbl>
    ## 1   4339 362831534.    NA      NA        NA  NA       
    ## 2   4338 354026448.     1 8805086.      108.  5.56e-25

``` r
fit_null2 = lm(bwt ~ bhead + blength, data = birthweight_df)
fit_alt2 = lm(bwt ~ bhead + blength + fincome, data = birthweight_df)

anova(fit_null2, fit_alt2) %>% 
  broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df    sumsq statistic   p.value
    ##    <dbl>      <dbl> <dbl>    <dbl>     <dbl>     <dbl>
    ## 1   4339 362831534.    NA      NA       NA   NA       
    ## 2   4338 357878582.     1 4952952.      60.0  1.15e-14

``` r
fit_null3 = lm(bwt ~ bhead + blength, data = birthweight_df)
fit_alt3 = lm(bwt ~ bhead + blength + gaweeks, data = birthweight_df)

anova(fit_null3, fit_alt3) %>% 
  broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df    sumsq statistic   p.value
    ##    <dbl>      <dbl> <dbl>    <dbl>     <dbl>     <dbl>
    ## 1   4339 362831534.    NA      NA       NA   NA       
    ## 2   4338 355164031.     1 7667503.      93.7  6.26e-22

``` r
fit_null4 = lm(bwt ~ bhead + blength, data = birthweight_df)
fit_alt4 = lm(bwt ~ bhead + blength + menarche, data = birthweight_df)

anova(fit_null4, fit_alt4) %>% 
  broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df   sumsq statistic p.value
    ##    <dbl>      <dbl> <dbl>   <dbl>     <dbl>   <dbl>
    ## 1   4339 362831534.    NA     NA      NA     NA    
    ## 2   4338 362623718.     1 207816.      2.49   0.115

``` r
fit_null5 = lm(bwt ~ bhead + blength, data = birthweight_df)
fit_alt5 = lm(bwt ~ bhead + blength + mheight, data = birthweight_df)

anova(fit_null5, fit_alt5) %>% 
  broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df    sumsq statistic   p.value
    ##    <dbl>      <dbl> <dbl>    <dbl>     <dbl>     <dbl>
    ## 1   4339 362831534.    NA      NA       NA   NA       
    ## 2   4338 357790035.     1 5041499.      61.1  6.68e-15

``` r
fit_null6 = lm(bwt ~ bhead + blength, data = birthweight_df)
fit_alt6 = lm(bwt ~ bhead + blength + momage, data = birthweight_df)

anova(fit_null6, fit_alt6) %>% 
  broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df    sumsq statistic  p.value
    ##    <dbl>      <dbl> <dbl>    <dbl>     <dbl>    <dbl>
    ## 1   4339 362831534.    NA      NA       NA   NA      
    ## 2   4338 359997579.     1 2833954.      34.1  5.48e-9

``` r
fit_null7 = lm(bwt ~ bhead + blength, data = birthweight_df)
fit_alt7 = lm(bwt ~ bhead + blength + parity, data = birthweight_df)

anova(fit_null7, fit_alt7) %>% 
  broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df   sumsq statistic p.value
    ##    <dbl>      <dbl> <dbl>   <dbl>     <dbl>   <dbl>
    ## 1   4339 362831534.    NA     NA      NA    NA     
    ## 2   4338 362555330.     1 276204.      3.30  0.0691

``` r
fit_null8 = lm(bwt ~ bhead + blength, data = birthweight_df)
fit_alt8 = lm(bwt ~ bhead + blength + pnumlbw, data = birthweight_df)

anova(fit_null8, fit_alt8) %>% 
  broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df sumsq statistic p.value
    ##    <dbl>      <dbl> <dbl> <dbl>     <dbl>   <dbl>
    ## 1   4339 362831534.    NA    NA        NA      NA
    ## 2   4339 362831534.     0     0        NA      NA

``` r
fit_null10 = lm(bwt ~ bhead + blength, data = birthweight_df)
fit_alt10 = lm(bwt ~ bhead + blength + ppbmi, data = birthweight_df)

anova(fit_null10, fit_alt10) %>% 
  broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df   sumsq statistic p.value
    ##    <dbl>      <dbl> <dbl>   <dbl>     <dbl>   <dbl>
    ## 1   4339 362831534.    NA     NA      NA    NA     
    ## 2   4338 362349742.     1 481792.      5.77  0.0164

``` r
fit_null11 = lm(bwt ~ bhead + blength, data = birthweight_df)
fit_alt11 = lm(bwt ~ bhead + blength + ppwt, data = birthweight_df)

anova(fit_null11, fit_alt11) %>% 
  broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df    sumsq statistic   p.value
    ##    <dbl>      <dbl> <dbl>    <dbl>     <dbl>     <dbl>
    ## 1   4339 362831534.    NA      NA       NA   NA       
    ## 2   4338 359602295.     1 3229239.      39.0  4.75e-10

``` r
fit_null12 = lm(bwt ~ bhead + blength, data = birthweight_df)
fit_alt12 = lm(bwt ~ bhead + blength + smoken, data = birthweight_df)

anova(fit_null12, fit_alt12) %>% 
  broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df   sumsq statistic p.value
    ##    <dbl>      <dbl> <dbl>   <dbl>     <dbl>   <dbl>
    ## 1   4339 362831534.    NA     NA      NA    NA     
    ## 2   4338 362325760.     1 505774.      6.06  0.0139

``` r
fit_null13 = lm(bwt ~ bhead + blength, data = birthweight_df)
fit_alt13 = lm(bwt ~ bhead + blength + wtgain, data = birthweight_df)

anova(fit_null13, fit_alt13) %>% 
  broom::tidy()
```

    ## # A tibble: 2 x 6
    ##   res.df        rss    df    sumsq statistic   p.value
    ##    <dbl>      <dbl> <dbl>    <dbl>     <dbl>     <dbl>
    ## 1   4339 362831534.    NA      NA       NA   NA       
    ## 2   4338 355943583.     1 6887951.      83.9  7.67e-20

Since we can reject the null hypothesis only when p.value is extremly
small, from the anova outcome above we can learn that `bhead`,
`blength`, `delwt`, `fincome`, `gaweeks`, `mheigth`, `momage`, `ppwt`,
`wtgain` are related to bwt.

Found the model

``` r
fit = lm(bwt ~ bhead + blength + delwt + fincome + gaweeks + mheight + momage + ppwt + wtgain, data = birthweight_df) 

bwt_res_pred_df = 
  birthweight_df %>% 
  modelr::add_predictions(fit) %>% 
  modelr::add_residuals(fit) 
```

    ## Warning in predict.lm(model, data): prediction from a rank-deficient fit may be
    ## misleading

    ## Warning in predict.lm(model, data): prediction from a rank-deficient fit may be
    ## misleading

``` r
bwt_res_pred_df %>% 
  ggplot(aes(x = bwt, y = pred)) + 
  geom_point() +
  geom_smooth()
```

    ## `geom_smooth()` using method = 'gam' and formula 'y ~ s(x, bs = "cs")'

![](p8105_hw6_yt2785_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->
